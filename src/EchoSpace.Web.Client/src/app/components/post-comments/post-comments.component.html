<div class="border-t border-gray-100 px-6 py-4 bg-gray-50">
  <!-- Comments List -->
  @if (isLoadingComments) {
    <div class="text-center py-4 text-gray-500">Loading comments...</div>
  } @else if (comments.length > 0) {
    <div class="space-y-4 mb-4">
      @for (comment of comments; track comment.commentId) {
        <div class="flex items-start space-x-3">
          <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary-500 to-indigo-600 flex items-center justify-center text-white text-xs font-semibold flex-shrink-0">
            {{ getCommentInitials(comment.userName, comment.userEmail) }}
          </div>
          <div class="flex-1 bg-white rounded-lg p-3">
            <div class="flex items-center justify-between mb-1">
              <div>
                <span class="font-semibold text-sm text-gray-900">{{ comment.userName || 'Unknown User' }}</span>
                <span class="text-xs text-gray-500 ml-2">{{ comment.timeAgo }}</span>
              </div>
              @if (isCommentOwner(comment)) {
                <div class="flex items-center space-x-2">
                  @if (editingCommentId === comment.commentId) {
                    <button (click)="saveEditComment(comment.commentId)" class="text-xs text-green-600 hover:text-green-700 font-medium">Save</button>
                    <button (click)="cancelEditComment()" class="text-xs text-gray-600 hover:text-gray-700 font-medium">Cancel</button>
                  } @else {
                    <button (click)="startEditComment(comment)" class="text-xs text-blue-600 hover:text-blue-700 font-medium">Edit</button>
                    <button (click)="deleteComment(comment.commentId)" class="text-xs text-red-600 hover:text-red-700 font-medium">Delete</button>
                  }
                </div>
              }
            </div>
            @if (editingCommentId === comment.commentId) {
              <textarea 
                [(ngModel)]="editCommentContent"
                class="w-full bg-gray-50 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"
                rows="2"
                maxlength="2000"
              ></textarea>
            } @else {
              <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ comment.content }}</p>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="text-center py-4 text-gray-500 text-sm">No comments yet. Be the first to comment!</div>
  }

  <!-- Add Comment Form -->
  <div class="mt-4 pt-4 border-t border-gray-200">
    <div class="flex items-start space-x-3">
      <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary-500 to-indigo-600 flex items-center justify-center text-white text-xs font-semibold flex-shrink-0">
        {{ currentUserInitials }}
      </div>
      <div class="flex-1">
        <textarea 
          [(ngModel)]="newCommentContent"
          placeholder="Write a comment..."
          class="w-full bg-white rounded-lg px-4 py-2 text-sm border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"
          rows="2"
          maxlength="2000"
          (keydown.enter)="$event.preventDefault(); createComment()"
        ></textarea>
        <div class="flex items-center justify-end mt-2">
          <button 
            (click)="createComment()"
            [disabled]="!newCommentContent.trim() || isCreatingComment"
            class="px-4 py-1.5 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition disabled:opacity-50 disabled:cursor-not-allowed">
            @if (isCreatingComment) {
              <span>Posting...</span>
            } @else {
              <span>Post</span>
            }
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

